{% extends 'main-layout.html' %}

<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="">
		<meta name="keywords" content="lisp, rgb, texture generation, webgl">
		
		{% block head %}
		{% parent %}
		{% endblock %}
	</head>

	<body onload="startupDraw()" style="background-color: black"  onkeydown="myFunction()">
		{% block content %}
		{% parent %}
		<div id="cosita">
		<div class="container" style="padding-top: 60px">
			<div id="main-div">
			<input style="display: none">
				<canvas id="parent0" width="650" height="650" draggable="true" ondragstart="drag(event)" ondragover="allowDrop(event)" ondrop="drop(event)" onclick="makeFullscreen()" style="width: 70%" ></canvas>
			</input>
			</div>
		</div>
		</div>

		{% endblock %}
	</body>

	{% block mainscript %}
	<script src="jquery-1.11.1.min.js"></script>
	<script src="bootstrap.min.js"></script>	
	
	<div id="context_menu" style="width:150px;border:1px solid black;background-color:#EEEEEE;visibility:hidden;position:absolute;line-height:30px; padding-left: 10px">
		<a href="/view.html">Open</a><br />
		<a href="/index.html">Like</a><br />
		<a href="/index.html">Send</a><br />
	</div>
	
	<script>
		var entitiesDictionary = {parent0: ["#A#", "#B#", "#C#"]};
		var currentLanguage = "#LANGUAGE#";

		function allowDrop(ev) {
			ev.preventDefault();
		}

		function drag(ev) {
			ev.dataTransfer.setData("Text", JSON.stringify(entitiesDictionary[ev.target.id]));
		}
		
		function drop(ev) {
			ev.preventDefault();
			var result = JSON.parse(ev.dataTransfer.getData("Text"));
			entitiesDictionary[ev.target.id] = result;
			
			if (result[2] == "entity-bw") {
				initWebGLBW(ev.target.id, result[1]);
				drawEntityImageBW();
			}
			else if (result[2] == "entity-rgb") {
				initWebGLRGB(ev.target.id, result[1]);
				drawEntityImageRGB();
			}
			else if (result[2] == "entity-rgb-animate") {
				initWebGLRGBAnimate("parent0", entitiesDictionary["parent0"][1]);
				drawEntityImageRGBAnimate();
			}
			else if (result[2] == "entity-rgb-animate-interpolation") {
				initWebGLRGBInterpolatedAnimate("parent0", entitiesDictionary["parent0"][1]);
				drawEntityImageRGBInterpolatedAnimate();
			}
		}

		window.onkeydown = myFunction;

		function takeOutFull() {
			var div = document.getElementById("cosita");
			div.innerHTML =
				"<div class=\"container\" style=\"padding-top: 60px\">" + 
				"<div id=\"main-div\">" + 
				"<input style=\"display: none\">" + 
				"	<canvas id=\"parent0\" width=\"{{ width }}\" height=\"{{ height }}\" draggable=\"true\" ondragstart=\"drag(event)\" ondragover=\"allowDrop(event)\" ondrop=\"drop(event)\" onclick=\"makeFullscreen()\" style=\"width: 70%\" +  ></canvas>" + 
				"</input>" + 
				"</div>" + 
				"</div>";

			if (document.exitFullscreen) {
			  document.exitFullscreen();
			} else if (document.msExitFullscreen) {
			  document.msExitFullscreen();
			} else if (document.mozCancelFullScreen) {
			  document.mozCancelFullScreen();
			} else if (document.webkitExitFullscreen) {
			  document.webkitExitFullscreen();
			}
		} 
		
		function makeFullscreen() {
			var div = document.getElementById("cosita");
			div.innerHTML =
				"<div style=\"display: block\"> " + 
				"<div id=\"divResult\" > " + 
				"	<canvas id=\"parent0\" width=\"{{ width }}\" height=\"{{ height }}\" onclick=\"takeOutFull()\" draggable=\"true\" ondragstart=\"drag(event)\" ondragover=\"allowDrop(event)\" ondrop=\"drop(event)\" style=\"width: " + window.screen.availWidth + "px; height: " + window.screen.availHeight + "px\"></canvas> " + 
				"</div>" + 
				"</div>";

		/*	document.addEventListener("webkitfullscreenchange", function(value) { 
				var div = document.getElementById("cosita");
			
				if (!(document.webkitIsFullScreen || document.mozFullScreen || document.msFullscreenElement !== null)) {
					div.innerHTML =
						"<div class=\"container\" style=\"padding-top: 60px\">" + 
						"<div id=\"main-div\">" + 
						"<input style=\"display: none\">" + 
						"	<canvas id=\"parent0\" width=\"650\" height=\"650\" draggable=\"true\" ondragstart=\"drag(event)\" ondragover=\"allowDrop(event)\" ondrop=\"drop(event)\" onclick=\"makeFullscreen()\" style=\"width: 70%\" +  ></canvas>" + 
						"</input>" + 
						"</div>" + 
						"</div>";

					var elem = document.getElementById("parent0");
					if (elem.requestFullscreen) {				elem.requestFullscreen();		}
					else if (elem.msRequestFullscreen) {		elem.msRequestFullscreen();		}
					else if (elem.mozRequestFullScreen) {		elem.mozRequestFullScreen();	}
					else if (elem.webkitRequestFullscreen) {	elem.webkitRequestFullscreen();	}	
				}
				else {
					div.innerHTML =
					"<div style=\"display: block\"> " + 
					"<div id=\"divResult\" > " + 
					"	<canvas id=\"parent0\" width=\"650\" height=\"650\" onclick=\"takeOutFull()\" draggable=\"true\" ondragstart=\"drag(event)\" ondragover=\"allowDrop(event)\" ondrop=\"drop(event)\" style=\"width: " + window.screen.availWidth + "px; height: " + window.screen.availHeight + "px\"></canvas> " + 
					"</div>" + 
					"</div>";
					
					var elem = document.getElementById("parent0");
					if (elem.requestFullscreen) {				elem.requestFullscreen();		}
					else if (elem.msRequestFullscreen) {		elem.msRequestFullscreen();		}
					else if (elem.mozRequestFullScreen) {		elem.mozRequestFullScreen();	}
					else if (elem.webkitRequestFullscreen) {	elem.webkitRequestFullscreen();	}	
				}
			}, false);  */

			var elem = document.getElementById("parent0");
			if (elem.requestFullscreen) {				elem.requestFullscreen();		}
			else if (elem.msRequestFullscreen) {		elem.msRequestFullscreen();		}
			else if (elem.mozRequestFullScreen) {		elem.mozRequestFullScreen();	}
			else if (elem.webkitRequestFullscreen) {	elem.webkitRequestFullscreen();	}
		}

		function myFunction(event) {
			if (event.ctrlKey) {
				if (event.keyCode == 38) globalScale += 0.1;
				if (event.keyCode == 40) globalScale -= 0.1;
			}
			else {
				if (event.keyCode == 38) globalYRef += 0.1;
				if (event.keyCode == 40) globalYRef -= 0.1;
				if (event.keyCode == 39) globalXRef += 0.1;
				if (event.keyCode == 37) globalXRef -= 0.1;
			}
		}

		var startupDraw = function () {
			if (entitiesDictionary["parent0"][2] == "entity-bw") {
				initWebGLBW("parent0", entitiesDictionary["parent0"][1]);
				drawEntityImageBW();
			}
			else if (entitiesDictionary["parent0"][2] == "entity-rgb") {
				initWebGLRGB("parent0", entitiesDictionary["parent0"][1]);

				setInterval(
				function () {
					initWebGLRGB("parent0", entitiesDictionary["parent0"][1]);
					drawEntityImageRGB();
				}, 
				50);
			}
			else if (entitiesDictionary["parent0"][2] == "entity-rgb-animate") {
				initWebGLRGBAnimate("parent0", entitiesDictionary["parent0"][1]);
				setInterval(
				function () {
					initWebGLRGBAnimate("parent0", entitiesDictionary["parent0"][1]);
					drawEntityImageRGBAnimate();
				}, 
				100);
			}

			document.getElementById('parent0').onkeypress = function(event) {
			  var char = getChar(event || window.event);
			  if (!char) return; // special key
			  console.log("rat");
			  return false;
			}
		};
		//initializeContextMenuOn("parent", "context_menu");
	</script>
	{% endblock %}

	{% block footerscript %}
	{% parent %}
	{% endblock %}
</html>